<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stream Schedule</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/modern-screenshot/dist/modern-screenshot.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dom-to-image-more@3.1.0/dist/dom-to-image-more.min.js"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/emoji-picker-element@1/index.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Improve html2canvas compatibility: force line-height and overflow for all children of #outerPaddingContainer */
        /* Only apply to timestamp containers */
        .timestamp-box {
            line-height: 1.2;
            overflow: hidden;
        }
        #outerPaddingContainer {
            background-color: var(--bg-primary);
        }
        body {
            font-family: 'Inter', sans-serif;
        }

        /* --- THEME DEFINITIONS --- */
        :root, .theme-twilight {
            --bg-primary: #111827;
            --bg-secondary: rgba(31, 41, 55, 0.5);
            --border-primary: rgba(55, 65, 81, 0.5);
            --text-primary: #f9fafb;
            --text-secondary: #d1d5db;
            --text-muted: #6b7280;
            --header-gradient-start: #c084fc;
            --header-gradient-end: #67e8f9;
            --header-glow: rgba(192, 132, 252, 0.3);
            --today-accent: #a78bfa;
            --today-accent-bg: rgba(167, 139, 250, 0.2);
            --today-header: #67e8f9;
            --today-header-border: rgba(103, 232, 249, 0.3);
            --tomorrow-bg: rgba(124, 58, 237, 0.4);
            --tomorrow-border: rgba(139, 92, 246, 0.5);
            --tomorrow-accent-bg: rgba(167, 139, 250, 0.2);
            --tomorrow-text: #ddd6fe;
            --tomorrow-header: #6ee7b7;
            --tomorrow-header-border: rgba(110, 231, 183, 0.3);
            /* UI Controls */
            --input-bg: #374151;
            --input-border: #4b5563;
            --btn-active-bg: #9333ea;
            --btn-inactive-bg: #4b5563;
            --tab-active-bg: #581c87;
            --tab-active-text: #f0abfc;
        }

        .theme-sunrise {
            --bg-primary: #1c1917;
            --bg-secondary: rgba(41, 37, 36, 0.5);
            --border-primary: rgba(68, 64, 60, 0.5);
            --text-primary: #fff7ed;
            --text-secondary: #fed7aa;
            --text-muted: #fde68a;
            --header-gradient-start: #f97316;
            --header-gradient-end: #ef4444;
            --header-glow: rgba(249, 115, 22, 0.3);
            --today-accent: #fb923c;
            --today-accent-bg: rgba(251, 146, 60, 0.1);
            --today-header: #fb923c;
            --today-header-border: rgba(251, 146, 60, 0.3);
            --tomorrow-bg: rgba(239, 68, 68, 0.2);
            --tomorrow-border: rgba(239, 68, 68, 0.4);
            --tomorrow-accent-bg: rgba(248, 113, 113, 0.15);
            --tomorrow-text: #fca5a5;
            --tomorrow-header: #f87171;
            --tomorrow-header-border: rgba(248, 113, 113, 0.3);
            /* UI Controls */
            --input-bg: #292524;
            --input-border: #44403c;
            --btn-active-bg: #ea580c;
            --btn-inactive-bg: #57534e;
            --tab-active-bg: #431407;
            --tab-active-text: #fdba74;
        }
        
        .theme-forest {
            --bg-primary: #052e16; /* Darker Green for better contrast */
            --bg-secondary: rgba(22, 101, 52, 0.5);
            --border-primary: rgba(20, 83, 45, 0.5);
            --text-primary: #f0fdf4;
            --text-secondary: #bbf7d0;
            --text-muted: #86efac;
            --header-gradient-start: #fde047;
            --header-gradient-end: #bef264;
            --header-glow: rgba(253, 224, 71, 0.2);
            --today-accent: #fde047;
            --today-accent-bg: rgba(253, 224, 71, 0.1);
            --today-header: #bef264;
            --today-header-border: rgba(190, 242, 100, 0.3);
            --tomorrow-bg: rgba(132, 204, 22, 0.2);
            --tomorrow-border: rgba(132, 204, 22, 0.4);
            --tomorrow-accent-bg: rgba(234, 179, 8, 0.15);
            --tomorrow-text: #fde047;
            --tomorrow-header: #a3e635;
            --tomorrow-header-border: rgba(163, 230, 53, 0.3);
            /* UI Controls */
            --input-bg: #166534;
            --input-border: #15803d;
            --btn-active-bg: #ca8a04;
            --btn-inactive-bg: #15803d;
            --tab-active-bg: #f7fee7;
            --tab-active-text: #4d7c0f;
        }

        .theme-oceanic {
            --bg-primary: #0c2d48;
            --bg-secondary: rgba(20, 69, 107, 0.5);
            --border-primary: rgba(20, 69, 107, 0.5);
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --header-gradient-start: #2dd4bf;
            --header-gradient-end: #7dd3fc;
            --header-glow: rgba(45, 212, 191, 0.3);
            --today-accent: #facc15;
            --today-accent-bg: rgba(250, 204, 21, 0.1);
            --today-header: #7dd3fc;
            --today-header-border: rgba(125, 211, 252, 0.3);
            --tomorrow-bg: rgba(20, 184, 166, 0.2);
            --tomorrow-border: rgba(20, 184, 166, 0.4);
            --tomorrow-accent-bg: rgba(20, 184, 166, 0.15);
            --tomorrow-text: #5eead4;
            --tomorrow-header: #2dd4bf;
            --tomorrow-header-border: rgba(45, 212, 191, 0.3);
            /* UI Controls */
            --input-bg: #1e40af;
            --input-border: #1d4ed8;
            --btn-active-bg: #0ea5e9;
            --btn-inactive-bg: #1e40af;
            --tab-active-bg: #e0f2fe;
            --tab-active-text: #0369a1;
        }

        .theme-cyberpunk {
            --bg-primary: #0a0a0a;
            --bg-secondary: rgba(23, 23, 23, 0.5);
            --border-primary: rgba(38, 38, 38, 0.5);
            --text-primary: #ffffff;
            --text-secondary: #e5e5e5;
            --text-muted: #a3a3a3;
            --header-gradient-start: #f472b6;
            --header-gradient-end: #38bdf8;
            --header-glow: rgba(244, 114, 182, 0.3);
            --today-accent: #fde047;
            --today-accent-bg: rgba(253, 224, 71, 0.1);
            --today-header: #f472b6;
            --today-header-border: rgba(244, 114, 182, 0.3);
            --tomorrow-bg: rgba(34, 211, 238, 0.2);
            --tomorrow-border: rgba(34, 211, 238, 0.4);
            --tomorrow-accent-bg: rgba(34, 211, 238, 0.15);
            --tomorrow-text: #67e8f9;
            --tomorrow-header: #22d3ee;
            --tomorrow-header-border: rgba(34, 211, 238, 0.3);
            /* UI Controls */
            --input-bg: #171717;
            --input-border: #262626;
            --btn-active-bg: #db2777;
            --btn-inactive-bg: #262626;
            --tab-active-bg: #fbcfe8;
            --tab-active-text: #9d174d;
        }

        .theme-pastel {
            --bg-primary: #2a2a3e;
            --bg-secondary: rgba(67, 56, 202, 0.2);
            --border-primary: rgba(99, 102, 241, 0.3);
            --text-primary: #e0e7ff;
            --text-secondary: #c7d2fe;
            --text-muted: #a5b4fc;
            --header-gradient-start: #f9a8d4;
            --header-gradient-end: #a5b4fc;
            --header-glow: rgba(249, 168, 212, 0.4);
            --today-accent: #f9a8d4;
            --today-accent-bg: rgba(249, 168, 212, 0.1);
            --today-header: #f9a8d4;
            --today-header-border: rgba(249, 168, 212, 0.5);
            --tomorrow-bg: rgba(165, 180, 252, 0.2);
            --tomorrow-border: rgba(165, 180, 252, 0.4);
            --tomorrow-accent-bg: rgba(165, 180, 252, 0.15);
            --tomorrow-text: #c7d2fe;
            --tomorrow-header: #a5b4fc;
            --tomorrow-header-border: rgba(165, 180, 252, 0.5);
            /* UI Controls */
            --input-bg: #312e81;
            --input-border: #4338ca;
            --btn-active-bg: #ec4899;
            --btn-inactive-bg: #6366f1;
            --tab-active-bg: #312e81;
            --tab-active-text: #fbcfe8;
        }

        .theme-arctic {
            --bg-primary: #0f172a;
            --bg-secondary: rgba(30, 58, 138, 0.3);
            --border-primary: rgba(59, 130, 246, 0.3);
            --text-primary: #f0f9ff;
            --text-secondary: #bae6fd;
            --text-muted: #7dd3fc;
            --header-gradient-start: #06b6d4;
            --header-gradient-end: #dbeafe;
            --header-glow: rgba(6, 182, 212, 0.4);
            --today-accent: #38bdf8;
            --today-accent-bg: rgba(56, 189, 248, 0.15);
            --today-header: #0ea5e9;
            --today-header-border: rgba(14, 165, 233, 0.4);
            --tomorrow-bg: rgba(147, 197, 253, 0.2);
            --tomorrow-border: rgba(147, 197, 253, 0.4);
            --tomorrow-accent-bg: rgba(224, 242, 254, 0.2);
            --tomorrow-text: #e0f2fe;
            --tomorrow-header: #7dd3fc;
            --tomorrow-header-border: rgba(125, 211, 252, 0.4);
            /* UI Controls */
            --input-bg: #1e3a8a;
            --input-border: #2563eb;
            --btn-active-bg: #0284c7;
            --btn-inactive-bg: #1e40af;
            --tab-active-bg: #dbeafe;
            --tab-active-text: #075985;
        }

        /* --- THEME-AWARE STYLES --- */
    .gradient-text { 
        color: var(--header-gradient-start); 
        text-shadow: 0 0 var(--title-glow-size, 20px) var(--header-glow),
                     0 0 var(--title-glow-size, 20px) var(--header-gradient-start);
        transition: text-shadow 0.3s ease;
    }
        .theme-btn.active { box-shadow: 0 0 0 3px var(--header-gradient-start); }
        
        .schedule-btn { background-color: var(--btn-inactive-bg); }
        .schedule-btn.active { background-color: var(--btn-active-bg); }
        
        .editor-tab { color: var(--text-secondary); }
        .editor-tab.active { background-color: var(--tab-active-bg); color: var(--tab-active-text); }
        
        .editor-input { background-color: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-primary); }
        .editor-input::placeholder { color: var(--text-muted); }
        .editor-input:focus { outline: 2px solid var(--header-gradient-start); border-color: transparent; }

        /* Custom styles for range sliders */
        input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: #374151; border-radius: 9999px; outline: none; opacity: 0.7; transition: opacity .2s; }
        input[type="range"]:hover { opacity: 1; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: #818cf8; cursor: pointer; border-radius: 50%; }
        input[type="range"]::-moz-range-thumb { width: 20px; height: 20px; background: #818cf8; cursor: pointer; border-radius: 50%; }

        /* Glowing Panel Style */
        .glowing-panel {
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 var(--panel-glow-size, 30px) var(--panel-glow-color, rgba(255, 255, 255, 0.1)),
                        inset 0 0 var(--panel-glow-size, 30px) var(--panel-glow-color, rgba(255, 255, 255, 0.05));
            transition: box-shadow 0.3s ease;
        }

        /* Emoji Picker */
        #emojiPicker {
            display: none;
            position: absolute;
            bottom: 100%;
            right: 0;
            margin-bottom: 8px;
            z-index: 50;
            width: 320px;
        }

        /* Weekly Planner Styles */
        .week-day-card {
            background-color: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 0.75rem;
            padding: 1rem;
            transition: all 0.3s ease;
        }
        .week-day-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        .day-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            background-color: var(--today-accent-bg);
            color: var(--today-accent);
        }
        #weeklyPlannerModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            overflow-y: auto;
            padding: 2rem;
        }
        .modal-content {
            max-width: 90%;
            margin: 0 auto;
            background: var(--bg-primary);
            border-radius: 1rem;
            padding: 2rem;
        }
        .screenshot-preview {
            margin-bottom: 2rem;
            border: 2px solid var(--border-primary);
            border-radius: 0.5rem;
            overflow: hidden;
        }
    </style>
</head>
<body class="bg-[var(--bg-primary)] text-[var(--text-primary)] antialiased transition-colors duration-300">

    <div class="container mx-auto max-w-5xl">
        <!-- Wrapper for Outer Padding -->
        <div id="outerPaddingContainer">
            <div id="masterPanel" class="glowing-panel rounded-2xl bg-transparent">
                <!-- Header/Title -->
                <header class="text-center mb-10">
                    <div class="bg-[var(--bg-secondary)] backdrop-blur-sm rounded-xl py-8 px-4 border border-[var(--border-primary)]">
                        <h1 id="channelNameDisplay" class="text-5xl sm:text-6xl font-extrabold tracking-tight gradient-text">
                            Audacious Gabe
                        </h1>
                        <a id="twitchLinkDisplay" href="https://www.twitch.tv/audaciousgabe" class="text-[var(--today-header)] hover:opacity-80 transition-all mt-3 text-lg inline-block" style="text-shadow: 0 0 var(--link-glow-size, 15px) var(--today-header);">
                            twitch.tv/audaciousgabe
                        </a>
                    </div>
                </header>

                <main class="space-y-12">
                     <!-- Today's Schedule -->
                    <div id="todaySection">
                        <h2 id="todayTitle" class="text-2xl font-bold text-[var(--today-header)] border-b-2 border-[var(--today-header-border)] pb-2 mb-6">
                            Today's Stream
                        </h2>
                        <!-- Container for the Normal Day Schedule -->
                        <div id="normalDayScheduleToday" class="space-y-4">
                            <!-- Time Slot 1 -->
                            <div class="bg-[var(--bg-secondary)] backdrop-blur-sm rounded-xl p-5 border border-[var(--border-primary)] flex items-center gap-4">
                                <div class="bg-[var(--today-accent-bg)] text-[var(--today-accent)] font-bold rounded-lg px-4 h-12 text-center w-48 flex items-center justify-center">
                                    <p>9:30 AM - 12:30 PM</p>
                                </div>
                                <div>
                                    <h3 id="todayNormalSlot1Title" class="text-xl font-semibold text-[var(--text-primary)]">Morning Warmup</h3>
                                    <p id="todayNormalSlot1Desc" class="text-[var(--text-secondary)] mt-1">Clearing admin tasks, then jumping into chill development.</p>
                                </div>
                            </div>
                            <!-- Time Slot 2 -->
                            <div class="bg-[var(--bg-secondary)] backdrop-blur-sm rounded-xl p-5 border border-[var(--border-primary)] flex items-center gap-4">
                                <div class="bg-[var(--today-accent-bg)] text-[var(--today-accent)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>1:00 PM - 4:00 PM</p>
                                </div>
                                <div>
                                    <h3 id="todayNormalSlot2Title" class="text-xl font-semibold text-[var(--text-primary)]">Focused Development + Prototype Speedrun</h3>
                                    <p id="todayNormalSlot2Desc" class="text-[var(--text-secondary)] mt-1">Getting stuff done and making things happen ✨👏</p>
                                </div>
                            </div>
                            <!-- Time Slot 3 -->
                            <div class="bg-[var(--bg-secondary)] backdrop-blur-sm rounded-xl p-5 border border-[var(--border-primary)] flex items-center gap-4">
                                <div class="bg-[var(--today-accent-bg)] text-[var(--today-accent)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>5:00 PM - 8:00 PM</p>
                                </div>
                                <div>
                                    <h3 id="todayNormalSlot3Title" class="text-xl font-semibold text-[var(--text-primary)]">Greenlight Development</h3>
                                    <p id="todayNormalSlot3Desc" class="text-[var(--text-secondary)] mt-1">You picked it, now we're building it.</p>
                                </div>
                            </div>
                            <!-- Time Slot 4 -->
                            <div class="bg-[var(--bg-secondary)] backdrop-blur-sm rounded-xl p-5 border border-[var(--border-primary)] flex items-center gap-4">
                                <div class="bg-[var(--today-accent-bg)] text-[var(--today-accent)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>9:00 PM - 12:00 AM</p>
                                </div>
                                <div>
                                    <h3 id="todayNormalSlot4Title" class="text-xl font-semibold text-[var(--text-primary)]">Late Night Admin</h3>
                                    <p id="todayNormalSlot4Desc" class="text-[var(--text-secondary)] mt-1">Winding down with some chill development.</p>
                                </div>
                            </div>
                        </div>
                        <!-- Container for the Work Day Schedule (initially hidden) -->
                        <div id="workDayScheduleToday" class="space-y-4 hidden">
                             <!-- Work Block 1 -->
                            <div class="bg-[var(--bg-secondary)] backdrop-blur-sm rounded-xl p-5 border border-[var(--border-primary)] flex items-center gap-4">
                                <div class="bg-[var(--today-accent-bg)] text-[var(--today-accent)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>9:30 AM - 12:30 PM</p>
                                </div>
                                <div>
                                    <h3 id="todayWorkSlot1Title" class="text-xl font-semibold text-[var(--text-primary)]">Morning Warmup</h3>
                                    <p id="todayWorkSlot1Desc" class="text-[var(--text-secondary)] mt-1">Clearing admin tasks, then jumping into chill development.</p>
                                </div>
                            </div>
                            <!-- Work Block 2 -->
                            <div class="bg-[var(--bg-secondary)] backdrop-blur-sm rounded-xl p-5 border border-[var(--border-primary)] flex items-center gap-4">
                                <div class="bg-[var(--today-accent-bg)] text-[var(--today-accent)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>12:30 PM - 3:30 PM</p>
                                </div>
                                <div>
                                    <h3 id="todayWorkSlot2Title" class="text-xl font-semibold text-[var(--text-primary)]">Focused Development + Prototype Speedrun</h3>
                                    <p id="todayWorkSlot2Desc" class="text-[var(--text-secondary)] mt-1">Getting stuff done and making things happen ✨👏</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
                
                <div id="bottomContent">
                    <!-- Tomorrow's Schedule -->
                    <div class="mt-12">
                        <h2 id="tomorrowTitle" class="text-2xl font-bold text-[var(--tomorrow-header)] border-b-2 border-[var(--tomorrow-header-border)] pb-2 mb-6">
                            Tomorrow's Stream
                        </h2>
                         <!-- Container for the Normal Day Schedule (initially hidden) -->
                        <div id="normalDayScheduleTomorrow" class="space-y-4 hidden">
                            <!-- Time Slot 1 -->
                            <div class="bg-[var(--tomorrow-bg)] backdrop-blur-sm rounded-xl p-5 border border-[var(--tomorrow-border)] flex items-center gap-4">
                                <div class="bg-[var(--tomorrow-accent-bg)] text-[var(--tomorrow-text)] font-bold rounded-lg px-4 h-12 text-center w-48 flex items-center justify-center">
                                    <p>9:30 AM - 12:30 PM</p>
                                </div>
                                <div>
                                    <h3 id="tomorrowNormalSlot1Title" class="text-xl font-semibold text-[var(--tomorrow-text)]">Morning Warmup</h3>
                                    <p id="tomorrowNormalSlot1Desc" class="text-[var(--text-secondary)] mt-1">Clearing admin tasks, then jumping into chill development.</p>
                                </div>
                            </div>
                            <!-- Time Slot 2 -->
                            <div class="bg-[var(--tomorrow-bg)] backdrop-blur-sm rounded-xl p-5 border border-[var(--tomorrow-border)] flex items-center gap-4">
                                <div class="bg-[var(--tomorrow-accent-bg)] text-[var(--tomorrow-text)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>1:00 PM - 4:00 PM</p>
                                </div>
                                <div>
                                    <h3 id="tomorrowNormalSlot2Title" class="text-xl font-semibold text-[var(--tomorrow-text)]">Focused Development + Prototype Speedrun</h3>
                                    <p id="tomorrowNormalSlot2Desc" class="text-[var(--text-secondary)] mt-1">Getting stuff done and making things happen ✨👏</p>
                                </div>
                            </div>
                            <!-- Time Slot 3 -->
                            <div class="bg-[var(--tomorrow-bg)] backdrop-blur-sm rounded-xl p-5 border border-[var(--tomorrow-border)] flex items-center gap-4">
                                <div class="bg-[var(--tomorrow-accent-bg)] text-[var(--tomorrow-text)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>5:00 PM - 8:00 PM</p>
                                </div>
                                <div>
                                    <h3 id="tomorrowNormalSlot3Title" class="text-xl font-semibold text-[var(--tomorrow-text)]">Greenlight Development</h3>
                                    <p id="tomorrowNormalSlot3Desc" class="text-[var(--text-secondary)] mt-1">You picked it, now we're building it.</p>
                                </div>
                            </div>
                            <!-- Time Slot 4 -->
                            <div class="bg-[var(--tomorrow-bg)] backdrop-blur-sm rounded-xl p-5 border border-[var(--tomorrow-border)] flex items-center gap-4">
                                <div class="bg-[var(--tomorrow-accent-bg)] text-[var(--tomorrow-text)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>9:00 PM - 12:00 AM</p>
                                </div>
                                <div>
                                    <h3 id="tomorrowNormalSlot4Title" class="text-xl font-semibold text-[var(--tomorrow-text)]">Late Night Admin</h3>
                                    <p id="tomorrowNormalSlot4Desc" class="text-[var(--text-secondary)] mt-1">Winding down with some chill development.</p>
                                </div>
                            </div>
                        </div>
                        <!-- Container for the Work Day Schedule -->
                        <div id="workDayScheduleTomorrow" class="space-y-4">
                            <!-- Work Block 1 -->
                            <div class="bg-[var(--tomorrow-bg)] backdrop-blur-sm rounded-xl p-5 border border-[var(--tomorrow-border)] flex items-center gap-4">
                                <div class="bg-[var(--tomorrow-accent-bg)] text-[var(--tomorrow-text)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>9:30 AM - 12:30 PM</p>
                                </div>
                                <div>
                                    <h3 id="tomorrowWorkSlot1Title" class="text-xl font-semibold text-[var(--tomorrow-text)]">Morning Warmup</h3>
                                    <p id="tomorrowWorkSlot1Desc" class="text-[var(--text-secondary)] mt-1">Clearing admin tasks, then jumping into chill development.</p>
                                </div>
                            </div>
                            <!-- Work Block 2 -->
                            <div class="bg-[var(--tomorrow-bg)] backdrop-blur-sm rounded-xl p-5 border border-[var(--tomorrow-border)] flex items-center gap-4">
                                <div class="bg-[var(--tomorrow-accent-bg)] text-[var(--tomorrow-text)] font-bold rounded-lg px-4 py-3 text-center w-48 flex items-center justify-center">
                                    <p>12:30 PM - 3:30 PM</p>
                                </div>
                                <div>
                                    <h3 id="tomorrowWorkSlot2Title" class="text-xl font-semibold text-[var(--tomorrow-text)]">Focused Development + Prototype Speedrun</h3>
                                    <p id="tomorrowWorkSlot2Desc" class="text-[var(--text-secondary)] mt-1">Getting stuff done and making things happen ✨👏</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Footer -->
                    <footer class="text-center mt-6">
                        <p id="timezoneTextDisplay" class="text-[var(--text-muted)]">All times are in EST</p>
                    </footer>
                </div>
            </div>
        </div>

        <!-- Customization Controls -->
        <div class="mt-8">
            <!-- Theme Settings -->
            <div class="mb-8 p-6 bg-[var(--bg-secondary)] rounded-xl border border-[var(--border-primary)]">
                <h3 class="text-xl font-bold text-center mb-6 text-[var(--text-secondary)]">Theme Settings</h3>
                <div id="theme-buttons" class="flex flex-wrap justify-center gap-4">
                    <button data-theme="twilight" class="theme-btn active bg-purple-600 text-white font-bold py-2 px-4 rounded-lg transition-all hover:scale-105">Twilight</button>
                    <button data-theme="sunrise" class="theme-btn bg-orange-500 text-white font-bold py-2 px-4 rounded-lg transition-all hover:scale-105">Sunrise</button>
                    <button data-theme="forest" class="theme-btn bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition-all hover:scale-105">Forest</button>
                    <button data-theme="oceanic" class="theme-btn bg-blue-500 text-white font-bold py-2 px-4 rounded-lg transition-all hover:scale-105">Oceanic</button>
                    <button data-theme="cyberpunk" class="theme-btn bg-pink-500 text-white font-bold py-2 px-4 rounded-lg transition-all hover:scale-105">Cyberpunk</button>
                    <button data-theme="pastel" class="theme-btn bg-indigo-300 text-indigo-900 font-bold py-2 px-4 rounded-lg transition-all hover:scale-105">Pastel</button>
                    <button data-theme="arctic" class="theme-btn bg-cyan-400 text-slate-900 font-bold py-2 px-4 rounded-lg transition-all hover:scale-105">Arctic</button>
                </div>
            </div>

            <!-- Panel Scope Settings -->
            <div class="mb-8 p-6 bg-[var(--bg-secondary)] rounded-xl border border-[var(--border-primary)]">
                <h3 class="text-xl font-bold text-center mb-6 text-[var(--text-secondary)]">Panel Scope</h3>
                <div class="flex justify-center items-center gap-4">
                    <span class="text-sm font-medium text-[var(--text-secondary)]">Today Only</span>
                    <label for="panelScopeToggle" class="relative inline-flex items-center cursor-pointer">
                      <input type="checkbox" value="" id="panelScopeToggle" class="sr-only peer" checked>
                      <div class="w-11 h-6 bg-[var(--btn-inactive-bg)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--btn-active-bg)]"></div>
                    </label>
                    <span class="text-sm font-medium text-[var(--text-secondary)]">Full Schedule</span>
                </div>
            </div>

            <!-- Schedule Settings -->
            <div class="mb-8 p-6 bg-[var(--bg-secondary)] rounded-xl border border-[var(--border-primary)]">
                <h3 class="text-xl font-bold text-center mb-6 text-[var(--text-secondary)]">Schedule Settings</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Today's Settings -->
                    <div class="text-center">
                        <label class="block mb-3 text-sm font-medium text-[var(--text-secondary)]">Today's Schedule Type</label>
                        <div class="flex justify-center gap-4">
                            <button id="setNormalDayToday" class="schedule-btn active text-white font-bold py-2 px-6 rounded-lg transition-transform hover:scale-105">Normal</button>
                            <button id="setWorkDayToday" class="schedule-btn text-white font-bold py-2 px-6 rounded-lg transition-transform hover:scale-105">Work</button>
                        </div>
                    </div>
                    <!-- Tomorrow's Settings -->
                    <div class="text-center">
                        <label class="block mb-3 text-sm font-medium text-[var(--text-secondary)]">Tomorrow's Schedule Type</label>
                        <div class="flex justify-center gap-4">
                            <button id="setNormalDayTomorrow" class="schedule-btn text-white font-bold py-2 px-6 rounded-lg transition-transform hover:scale-105">Normal</button>
                            <button id="setWorkDayTomorrow" class="schedule-btn active text-white font-bold py-2 px-6 rounded-lg transition-transform hover:scale-105">Work</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Editor -->
            <div class="mb-8 p-6 bg-[var(--bg-secondary)] rounded-xl border border-[var(--border-primary)]">
                <h3 class="text-xl font-bold text-center mb-6 text-[var(--text-secondary)]">Editor</h3>
                
                <!-- Global Settings -->
                <div class="mb-6">
                    <h4 class="text-lg font-semibold mb-4 text-[var(--text-secondary)]">Global Settings</h4>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Channel Name</label>
                            <input type="text" id="channelNameInput" class="editor-input w-full rounded-md p-2" value="Audacious Gabe">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Twitch Channel Link</label>
                            <input type="text" id="twitchLinkInput" class="editor-input w-full rounded-md p-2" value="https://www.twitch.tv/audaciousgabe">
                        </div>
                    </div>
                </div>
                
                <!-- Editor Tabs -->
                <div class="flex justify-center border-b border-[var(--border-primary)] mb-6">
                    <button id="editTodayTab" class="editor-tab active py-2 px-6 font-semibold rounded-t-lg">Edit Today</button>
                    <button id="editTomorrowTab" class="editor-tab py-2 px-6 font-semibold rounded-t-lg">Edit Tomorrow</button>
                </div>

                <!-- Today's Editor Panel -->
                <div id="todayEditor">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Main Title</label>
                            <input type="text" id="todayTitleInput" class="editor-input w-full rounded-md p-2">
                        </div>
                        <hr class="border-[var(--border-primary)]">
                        <h4 class="font-semibold text-[var(--today-accent)]">Normal Day Schedule</h4>
                        <!-- Normal Day Inputs -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <input type="text" id="todayNormalSlot1TitleInput" placeholder="Slot 1 Title" class="editor-input rounded p-2">
                            <input type="text" id="todayNormalSlot1DescInput" placeholder="Slot 1 Description" class="editor-input rounded p-2">
                            <input type="text" id="todayNormalSlot2TitleInput" placeholder="Slot 2 Title" class="editor-input rounded p-2">
                            <input type="text" id="todayNormalSlot2DescInput" placeholder="Slot 2 Description" class="editor-input rounded p-2">
                            <input type="text" id="todayNormalSlot3TitleInput" placeholder="Slot 3 Title" class="editor-input rounded p-2">
                            <input type="text" id="todayNormalSlot3DescInput" placeholder="Slot 3 Description" class="editor-input rounded p-2">
                            <input type="text" id="todayNormalSlot4TitleInput" placeholder="Slot 4 Title" class="editor-input rounded p-2">
                            <input type="text" id="todayNormalSlot4DescInput" placeholder="Slot 4 Description" class="editor-input rounded p-2">
                        </div>
                        <hr class="border-[var(--border-primary)]">
                        <h4 class="font-semibold text-[var(--today-accent)]">Work Day Schedule</h4>
                        <!-- Work Day Inputs -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                             <input type="text" id="todayWorkSlot1TitleInput" placeholder="Slot 1 Title" class="editor-input rounded p-2">
                            <input type="text" id="todayWorkSlot1DescInput" placeholder="Slot 1 Description" class="editor-input rounded p-2">
                            <input type="text" id="todayWorkSlot2TitleInput" placeholder="Slot 2 Title" class="editor-input rounded p-2">
                            <input type="text" id="todayWorkSlot2DescInput" placeholder="Slot 2 Description" class="editor-input rounded p-2">
                        </div>
                    </div>
                </div>

                <!-- Tomorrow's Editor Panel (hidden by default) -->
                <div id="tomorrowEditor" class="hidden">
                     <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Main Title</label>
                            <input type="text" id="tomorrowTitleInput" class="editor-input w-full rounded-md p-2">
                        </div>
                        <hr class="border-[var(--border-primary)]">
                        <h4 class="font-semibold text-[var(--tomorrow-text)]">Normal Day Schedule</h4>
                        <!-- Normal Day Inputs -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <input type="text" id="tomorrowNormalSlot1TitleInput" placeholder="Slot 1 Title" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowNormalSlot1DescInput" placeholder="Slot 1 Description" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowNormalSlot2TitleInput" placeholder="Slot 2 Title" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowNormalSlot2DescInput" placeholder="Slot 2 Description" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowNormalSlot3TitleInput" placeholder="Slot 3 Title" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowNormalSlot3DescInput" placeholder="Slot 3 Description" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowNormalSlot4TitleInput" placeholder="Slot 4 Title" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowNormalSlot4DescInput" placeholder="Slot 4 Description" class="editor-input rounded p-2">
                        </div>
                        <hr class="border-[var(--border-primary)]">
                        <h4 class="font-semibold text-[var(--tomorrow-text)]">Work Day Schedule</h4>
                        <!-- Work Day Inputs -->
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                             <input type="text" id="tomorrowWorkSlot1TitleInput" placeholder="Slot 1 Title" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowWorkSlot1DescInput" placeholder="Slot 1 Description" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowWorkSlot2TitleInput" placeholder="Slot 2 Title" class="editor-input rounded p-2">
                            <input type="text" id="tomorrowWorkSlot2DescInput" placeholder="Slot 2 Description" class="editor-input rounded p-2">
                        </div>
                    </div>
                </div>
                
                <!-- Timezone Setting (at bottom to match layout) -->
                <div class="mt-6 pt-6 border-t border-[var(--border-primary)]">
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-1">Timezone Text</label>
                        <input type="text" id="timezoneTextInput" class="editor-input w-full rounded-md p-2" value="All times are in EST">
                    </div>
                </div>
            </div>

            <!-- Layout Settings -->
            <div class="mb-8 p-6 bg-[var(--bg-secondary)] rounded-xl border border-[var(--border-primary)]">
                <h3 class="text-xl font-bold text-center mb-6 text-[var(--text-secondary)]">Layout Customization</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-x-8 gap-y-6">
                    <!-- Outer Padding -->
                    <div class="md:col-span-2">
                        <h4 class="font-semibold text-center mb-4 text-[var(--text-secondary)]">Outer Padding</h4>
                    </div>
                    <div>
                        <label for="outerPaddingTop" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Top</label>
                        <div class="flex items-center gap-4">
                            <input id="outerPaddingTop" type="range" min="0" max="128" value="32" class="w-full">
                            <span id="outerPaddingTopValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">32px</span>
                        </div>
                    </div>
                    <div>
                        <label for="outerPaddingBottom" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Bottom</label>
                         <div class="flex items-center gap-4">
                            <input id="outerPaddingBottom" type="range" min="0" max="128" value="32" class="w-full">
                            <span id="outerPaddingBottomValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">32px</span>
                        </div>
                    </div>
                    <div>
                        <label for="outerPaddingLeft" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Left</label>
                         <div class="flex items-center gap-4">
                            <input id="outerPaddingLeft" type="range" min="0" max="128" value="32" class="w-full">
                            <span id="outerPaddingLeftValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">32px</span>
                        </div>
                    </div>
                    <div>
                        <label for="outerPaddingRight" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Right</label>
                         <div class="flex items-center gap-4">
                            <input id="outerPaddingRight" type="range" min="0" max="128" value="32" class="w-full">
                            <span id="outerPaddingRightValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">32px</span>
                        </div>
                    </div>
                    <!-- Inner Padding -->
                     <div class="md:col-span-2 pt-4 mt-4 border-t border-[var(--border-primary)]">
                        <h4 class="font-semibold text-center mb-4 text-[var(--text-secondary)]">Inner Padding</h4>
                    </div>
                     <div>
                        <label for="innerPaddingTop" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Top</label>
                        <div class="flex items-center gap-4">
                            <input id="innerPaddingTop" type="range" min="0" max="128" value="32" class="w-full">
                            <span id="innerPaddingTopValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">32px</span>
                        </div>
                    </div>
                    <div>
                        <label for="innerPaddingBottom" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Bottom</label>
                         <div class="flex items-center gap-4">
                            <input id="innerPaddingBottom" type="range" min="0" max="128" value="32" class="w-full">
                            <span id="innerPaddingBottomValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">32px</span>
                        </div>
                    </div>
                    <div>
                        <label for="innerPaddingLeft" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Left</label>
                         <div class="flex items-center gap-4">
                            <input id="innerPaddingLeft" type="range" min="0" max="128" value="32" class="w-full">
                            <span id="innerPaddingLeftValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">32px</span>
                        </div>
                    </div>
                    <div>
                        <label for="innerPaddingRight" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Right</label>
                         <div class="flex items-center gap-4">
                            <input id="innerPaddingRight" type="range" min="0" max="128" value="32" class="w-full">
                            <span id="innerPaddingRightValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">32px</span>
                        </div>
                    </div>
                    <!-- Glow Customization -->
                    <div class="md:col-span-2 pt-4 mt-4 border-t border-[var(--border-primary)]">
                        <h4 class="font-semibold text-center mb-4 text-[var(--text-secondary)]">Glow Effects</h4>
                    </div>
                    <div>
                        <label for="titleGlowSize" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Title Glow</label>
                        <div class="flex items-center gap-4">
                            <input id="titleGlowSize" type="range" min="0" max="60" value="20" class="w-full">
                            <span id="titleGlowSizeValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">20px</span>
                        </div>
                    </div>
                    <div>
                        <label for="linkGlowSize" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Link Glow</label>
                        <div class="flex items-center gap-4">
                            <input id="linkGlowSize" type="range" min="0" max="40" value="15" class="w-full">
                            <span id="linkGlowSizeValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">15px</span>
                        </div>
                    </div>
                    <div>
                        <label for="panelGlowSize" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Panel Glow</label>
                        <div class="flex items-center gap-4">
                            <input id="panelGlowSize" type="range" min="0" max="80" value="30" class="w-full">
                            <span id="panelGlowSizeValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">30px</span>
                        </div>
                    </div>
                    <div>
                        <label for="glowIntensity" class="block mb-2 text-sm font-medium text-[var(--text-secondary)]">Glow Intensity</label>
                        <div class="flex items-center gap-4">
                            <input id="glowIntensity" type="range" min="0" max="100" value="30" class="w-full">
                            <span id="glowIntensityValue" class="text-sm text-[var(--today-header)] font-mono w-10 text-right">30%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Discord Message Generator -->
            <div class="mb-8 p-6 bg-[var(--bg-secondary)] rounded-xl border border-[var(--border-primary)]">
                <h3 class="text-xl font-bold text-center mb-6 text-[var(--text-secondary)]">Discord Message Generator</h3>
                <div class="mb-4 relative">
                    <label for="discordTitleInput" class="block text-sm font-medium text-[var(--text-secondary)] mb-2">Announcement Title</label>
                    <div class="flex items-center gap-2">
                        <input type="text" id="discordTitleInput" class="editor-input w-full rounded-md p-2" value="Doubling our Usual Hours! ✨👏">
                        <button id="emojiBtn" class="schedule-btn active text-white font-bold py-2 px-4 rounded-lg" title="Insert emoji">😀</button>
                    </div>
                    <emoji-picker id="emojiPicker" theme="dark"></emoji-picker>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                    <div>
                        <label class="block text-sm font-medium text-[var(--text-secondary)] mb-2">Timestamp Format</label>
                        <select id="timestampFormat" class="editor-input w-full rounded-md p-2">
                            <option value="t">Short Time (e.g., 10:30 AM)</option>
                            <option value="T">Long Time (e.g., 10:30:00 AM)</option>
                            <option value="d">Short Date (e.g., 08/23/2025)</option>
                            <option value="D">Long Date (e.g., August 23, 2025)</option>
                            <option value="f">Short Date/Time (e.g., August 23, 2025 10:30 AM)</option>
                            <option value="F">Long Date/Time (e.g., Saturday, August 23, 2025 10:30 AM)</option>
                            <option value="R">Relative Time (e.g., in 2 hours)</option>
                        </select>
                    </div>
                    <div class="flex items-end justify-center">
                         <div class="flex items-center gap-4">
                            <span class="text-sm font-medium text-[var(--text-secondary)]">Default</span>
                            <label for="useTimestampsToggle" class="relative inline-flex items-center cursor-pointer">
                              <input type="checkbox" value="" id="useTimestampsToggle" class="sr-only peer" checked>
                              <div class="w-11 h-6 bg-[var(--btn-inactive-bg)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--btn-active-bg)]"></div>
                            </label>
                            <span class="text-sm font-medium text-[var(--text-secondary)]">Timestamps</span>
                        </div>
                    </div>
                </div>
                <textarea id="discordMessageOutput" readonly class="editor-input w-full h-64 rounded-md p-2 resize-none"></textarea>
                <button id="copyMessageBtn" class="schedule-btn active mt-4 w-full text-white font-bold py-3 px-6 rounded-lg transition-transform hover:scale-105">Copy Message</button>
            </div>

             <!-- Export Schedule -->
            <div class="p-6 bg-[var(--bg-secondary)] rounded-xl border border-[var(--border-primary)]">
                <h3 class="text-xl font-bold text-center mb-6 text-[var(--text-secondary)]">Export Schedule</h3>
                <button id="exportBtn" class="schedule-btn active w-full text-white font-bold py-3 px-6 rounded-lg transition-transform hover:scale-105">
                    💾 Download Schedule as PNG
                </button>
            </div>

            <!-- Weekly Planner -->
            <div class="mb-8 p-6 bg-[var(--bg-secondary)] rounded-xl border border-[var(--border-primary)]">
                <h3 class="text-xl font-bold text-center mb-6 text-[var(--text-secondary)]">Weekly Schedule Planner</h3>
                <p class="text-sm text-center text-[var(--text-muted)] mb-6">Plan your entire week and generate individual schedule images for each day</p>
                
                <!-- Days Grid -->
                <div id="weekDayCards" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-6"></div>
                
                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-3">
                    <button id="generateWeeklyScreenshots" class="schedule-btn active flex-1 text-white font-bold py-3 px-6 rounded-lg transition-transform hover:scale-105">
                        📅 Generate Week Screenshots
                    </button>
                    <button id="previewWeeklySchedule" class="schedule-btn active flex-1 text-white font-bold py-3 px-6 rounded-lg transition-transform hover:scale-105">
                        👁️ Preview All Days
                    </button>
                </div>
            </div>

            <!-- Weekly Preview Modal -->
            <div id="weeklyPlannerModal">
                <div class="modal-content">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-2xl font-bold text-[var(--text-primary)]">Weekly Schedule Preview</h2>
                        <button id="closeWeeklyModal" class="text-3xl text-[var(--text-muted)] hover:text-[var(--text-primary)]">&times;</button>
                    </div>
                    <div id="weeklyPreviewContainer" class="space-y-8">
                        <!-- Preview content will be generated here -->
                    </div>
                    <div class="mt-6 flex justify-center">
                        <button id="downloadAllWeekly" class="schedule-btn active text-white font-bold py-3 px-8 rounded-lg transition-transform hover:scale-105">
                            💾 Download All as ZIP
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Date Setup ---
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            const dateOptions = { month: 'short', day: 'numeric' };
            
            const todayString = today.toLocaleDateString('en-US', dateOptions);
            const tomorrowString = tomorrow.toLocaleDateString('en-US', dateOptions);

            const todayTitleEl = document.getElementById('todayTitle');
            const tomorrowTitleEl = document.getElementById('tomorrowTitle');
            
            const todayTitleText = `Today's Stream &bull; ${todayString}`;
            const tomorrowTitleText = `Tomorrow's Stream &bull; ${tomorrowString}`;

            todayTitleEl.innerHTML = todayTitleText;
            tomorrowTitleEl.innerHTML = tomorrowTitleText;


            // --- Theme Controls ---
            const themeButtonsContainer = document.getElementById('theme-buttons');
            themeButtonsContainer.addEventListener('click', (e) => {
                if (e.target.tagName === 'BUTTON') {
                    const theme = e.target.dataset.theme;
                    document.body.className = `bg-[var(--bg-primary)] text-[var(--text-primary)] antialiased transition-colors duration-300 theme-${theme}`;
                    
                    // Update active button style
                    themeButtonsContainer.querySelector('.active').classList.remove('active');
                    e.target.classList.add('active');
                }
            });

            // --- Panel Scope Toggle ---
            const panelScopeToggle = document.getElementById('panelScopeToggle');
            const masterPanel = document.getElementById('masterPanel');
            const bottomContent = document.getElementById('bottomContent');

            panelScopeToggle.addEventListener('change', () => {
                if (panelScopeToggle.checked) {
                    // Full Scope: Append bottom content to master panel
                    masterPanel.appendChild(bottomContent);
                } else {
                    // Today Only: Append bottom content after master panel's parent
                    masterPanel.parentNode.insertBefore(bottomContent, masterPanel.nextSibling);
                }
            });

            // --- Schedule Type Controls ---
            const scheduleControls = {
                today: {
                    normalBtn: document.getElementById('setNormalDayToday'),
                    workBtn: document.getElementById('setWorkDayToday'),
                    normalSchedule: document.getElementById('normalDayScheduleToday'),
                    workSchedule: document.getElementById('workDayScheduleToday'),
                },
                tomorrow: {
                    normalBtn: document.getElementById('setNormalDayTomorrow'),
                    workBtn: document.getElementById('setWorkDayTomorrow'),
                    normalSchedule: document.getElementById('normalDayScheduleTomorrow'),
                    workSchedule: document.getElementById('workDayScheduleTomorrow'),
                }
            };

            function setupScheduleToggle(day) {
                const controls = scheduleControls[day];
                controls.normalBtn.addEventListener('click', () => {
                    controls.normalSchedule.classList.remove('hidden');
                    controls.workSchedule.classList.add('hidden');
                    controls.normalBtn.classList.add('active');
                    controls.workBtn.classList.remove('active');
                    generateDiscordMessage();
                });
                controls.workBtn.addEventListener('click', () => {
                    controls.normalSchedule.classList.add('hidden');
                    controls.workSchedule.classList.remove('hidden');
                    controls.workBtn.classList.add('active');
                    controls.normalBtn.classList.remove('active');
                    generateDiscordMessage();
                });
            }
            setupScheduleToggle('today');
            setupScheduleToggle('tomorrow');

            // --- Content Editor Tabs ---
            const editTodayTab = document.getElementById('editTodayTab');
            const editTomorrowTab = document.getElementById('editTomorrowTab');
            const todayEditor = document.getElementById('todayEditor');
            const tomorrowEditor = document.getElementById('tomorrowEditor');

            editTodayTab.addEventListener('click', () => {
                todayEditor.classList.remove('hidden');
                tomorrowEditor.classList.add('hidden');
                editTodayTab.classList.add('active');
                editTomorrowTab.classList.remove('active');
            });

            editTomorrowTab.addEventListener('click', () => {
                todayEditor.classList.add('hidden');
                tomorrowEditor.classList.remove('hidden');
                editTodayTab.classList.remove('active');
                editTomorrowTab.classList.add('active');
            });

            // --- Content Binding ---
            const bindings = [
                // Today
                { inputId: 'todayTitleInput', displayId: 'todayTitle' },
                { inputId: 'todayNormalSlot1TitleInput', displayId: 'todayNormalSlot1Title' },
                { inputId: 'todayNormalSlot1DescInput', displayId: 'todayNormalSlot1Desc' },
                { inputId: 'todayNormalSlot2TitleInput', displayId: 'todayNormalSlot2Title' },
                { inputId: 'todayNormalSlot2DescInput', displayId: 'todayNormalSlot2Desc' },
                { inputId: 'todayNormalSlot3TitleInput', displayId: 'todayNormalSlot3Title' },
                { inputId: 'todayNormalSlot3DescInput', displayId: 'todayNormalSlot3Desc' },
                { inputId: 'todayNormalSlot4TitleInput', displayId: 'todayNormalSlot4Title' },
                { inputId: 'todayNormalSlot4DescInput', displayId: 'todayNormalSlot4Desc' },
                { inputId: 'todayWorkSlot1TitleInput', displayId: 'todayWorkSlot1Title' },
                { inputId: 'todayWorkSlot1DescInput', displayId: 'todayWorkSlot1Desc' },
                { inputId: 'todayWorkSlot2TitleInput', displayId: 'todayWorkSlot2Title' },
                { inputId: 'todayWorkSlot2DescInput', displayId: 'todayWorkSlot2Desc' },
                // Tomorrow
                { inputId: 'tomorrowTitleInput', displayId: 'tomorrowTitle' },
                { inputId: 'tomorrowNormalSlot1TitleInput', displayId: 'tomorrowNormalSlot1Title' },
                { inputId: 'tomorrowNormalSlot1DescInput', displayId: 'tomorrowNormalSlot1Desc' },
                { inputId: 'tomorrowNormalSlot2TitleInput', displayId: 'tomorrowNormalSlot2Title' },
                { inputId: 'tomorrowNormalSlot2DescInput', displayId: 'tomorrowNormalSlot2Desc' },
                { inputId: 'tomorrowNormalSlot3TitleInput', displayId: 'tomorrowNormalSlot3Title' },
                { inputId: 'tomorrowNormalSlot3DescInput', displayId: 'tomorrowNormalSlot3Desc' },
                { inputId: 'tomorrowNormalSlot4TitleInput', displayId: 'tomorrowNormalSlot4Title' },
                { inputId: 'tomorrowNormalSlot4DescInput', displayId: 'tomorrowNormalSlot4Desc' },
                { inputId: 'tomorrowWorkSlot1TitleInput', displayId: 'tomorrowWorkSlot1Title' },
                { inputId: 'tomorrowWorkSlot1DescInput', displayId: 'tomorrowWorkSlot1Desc' },
                { inputId: 'tomorrowWorkSlot2TitleInput', displayId: 'tomorrowWorkSlot2Title' },
                { inputId: 'tomorrowWorkSlot2DescInput', displayId: 'tomorrowWorkSlot2Desc' },
            ];

            function setupBinding({ inputId, displayId }) {
                const inputEl = document.getElementById(inputId);
                const displayEl = document.getElementById(displayId);
                // Set initial value for the input from the display element
                inputEl.value = displayEl.innerHTML;
                // Add event listener to update display on input
                inputEl.addEventListener('input', () => {
                    displayEl.innerHTML = inputEl.value;
                });
            }

            bindings.forEach(setupBinding);

            // --- Global Settings Binding ---
            const channelNameInput = document.getElementById('channelNameInput');
            const channelNameDisplay = document.getElementById('channelNameDisplay');
            const twitchLinkInput = document.getElementById('twitchLinkInput');
            const twitchLinkDisplay = document.getElementById('twitchLinkDisplay');
            const timezoneTextInput = document.getElementById('timezoneTextInput');
            const timezoneTextDisplay = document.getElementById('timezoneTextDisplay');
            
            // Channel name binding
            channelNameInput.addEventListener('input', () => {
                channelNameDisplay.textContent = channelNameInput.value;
            });
            
            // Twitch link binding
            twitchLinkInput.addEventListener('input', () => {
                const url = twitchLinkInput.value;
                twitchLinkDisplay.href = url;
                // Extract username from URL for display text
                const match = url.match(/twitch\.tv\/([^/?]+)/);
                if (match) {
                    twitchLinkDisplay.textContent = `twitch.tv/${match[1]}`;
                } else {
                    twitchLinkDisplay.textContent = url;
                }
            });
            
            // Timezone text binding
            timezoneTextInput.addEventListener('input', () => {
                timezoneTextDisplay.textContent = timezoneTextInput.value;
            });

            // --- Layout Padding Controls ---
            const outerPaddingContainer = document.getElementById('outerPaddingContainer');
            
            const outerSliders = {
                'paddingTop': { input: document.getElementById('outerPaddingTop'), valueSpan: document.getElementById('outerPaddingTopValue'), styleProperty: 'paddingTop' },
                'paddingBottom': { input: document.getElementById('outerPaddingBottom'), valueSpan: document.getElementById('outerPaddingBottomValue'), styleProperty: 'paddingBottom' },
                'paddingLeft': { input: document.getElementById('outerPaddingLeft'), valueSpan: document.getElementById('outerPaddingLeftValue'), styleProperty: 'paddingLeft' },
                'paddingRight': { input: document.getElementById('outerPaddingRight'), valueSpan: document.getElementById('outerPaddingRightValue'), styleProperty: 'paddingRight' }
            };
             const innerSliders = {
                'paddingTop': { input: document.getElementById('innerPaddingTop'), valueSpan: document.getElementById('innerPaddingTopValue'), styleProperty: 'paddingTop' },
                'paddingBottom': { input: document.getElementById('innerPaddingBottom'), valueSpan: document.getElementById('innerPaddingBottomValue'), styleProperty: 'paddingBottom' },
                'paddingLeft': { input: document.getElementById('innerPaddingLeft'), valueSpan: document.getElementById('innerPaddingLeftValue'), styleProperty: 'paddingLeft' },
                'paddingRight': { input: document.getElementById('innerPaddingRight'), valueSpan: document.getElementById('innerPaddingRightValue'), styleProperty: 'paddingRight' }
            };

            function updatePadding(key, sliders, targetElement) {
                const { input, valueSpan, styleProperty } = sliders[key];
                const value = input.value;
                targetElement.style[styleProperty] = `${value}px`;
                valueSpan.textContent = `${value}px`;
            }

            for (const key in outerSliders) {
                updatePadding(key, outerSliders, outerPaddingContainer);
                outerSliders[key].input.addEventListener('input', () => updatePadding(key, outerSliders, outerPaddingContainer));
            }
             for (const key in innerSliders) {
                updatePadding(key, innerSliders, masterPanel);
                innerSliders[key].input.addEventListener('input', () => updatePadding(key, innerSliders, masterPanel));
            }

            // --- Glow Effects Controls ---
            const titleGlowSlider = document.getElementById('titleGlowSize');
            const titleGlowValue = document.getElementById('titleGlowSizeValue');
            const linkGlowSlider = document.getElementById('linkGlowSize');
            const linkGlowValue = document.getElementById('linkGlowSizeValue');
            const panelGlowSlider = document.getElementById('panelGlowSize');
            const panelGlowValue = document.getElementById('panelGlowSizeValue');
            const glowIntensitySlider = document.getElementById('glowIntensity');
            const glowIntensityValue = document.getElementById('glowIntensityValue');
            const twitchLinkDisplay = document.getElementById('twitchLinkDisplay');
            
            function updateGlowEffects() {
                const titleGlow = titleGlowSlider.value;
                const linkGlow = linkGlowSlider.value;
                const panelGlow = panelGlowSlider.value;
                const intensity = glowIntensitySlider.value / 100;
                
                // Update CSS variables
                document.documentElement.style.setProperty('--title-glow-size', titleGlow + 'px');
                document.documentElement.style.setProperty('--link-glow-size', linkGlow + 'px');
                document.documentElement.style.setProperty('--panel-glow-size', panelGlow + 'px');
                
                // Calculate glow color with intensity
                const computedStyles = getComputedStyle(document.body);
                const headerGlow = computedStyles.getPropertyValue('--header-glow').trim();
                const panelGlowColor = `rgba(255, 255, 255, ${0.1 * intensity})`;
                document.documentElement.style.setProperty('--panel-glow-color', panelGlowColor);
                
                // Update link glow inline style
                if (twitchLinkDisplay) {
                    const linkColor = computedStyles.getPropertyValue('--today-header').trim();
                    twitchLinkDisplay.style.textShadow = `0 0 ${linkGlow}px ${linkColor}`;
                }
                
                // Update display values
                titleGlowValue.textContent = titleGlow + 'px';
                linkGlowValue.textContent = linkGlow + 'px';
                panelGlowValue.textContent = panelGlow + 'px';
                glowIntensityValue.textContent = Math.round(intensity * 100) + '%';
            }
            
            // Initialize glow effects
            updateGlowEffects();
            
            // Add event listeners
            titleGlowSlider.addEventListener('input', updateGlowEffects);
            linkGlowSlider.addEventListener('input', updateGlowEffects);
            panelGlowSlider.addEventListener('input', updateGlowEffects);
            glowIntensitySlider.addEventListener('input', updateGlowEffects);

            // --- Discord Message Generator ---
            const discordMessageOutput = document.getElementById('discordMessageOutput');
            const copyMessageBtn = document.getElementById('copyMessageBtn');
            const useTimestampsToggle = document.getElementById('useTimestampsToggle');
            const timestampFormatSelect = document.getElementById('timestampFormat');
            const discordTitleInput = document.getElementById('discordTitleInput');

            function getTimestamp(date, hours, minutes) {
                const d = new Date(date);
                d.setHours(hours, minutes, 0, 0);
                return Math.floor(d.getTime() / 1000);
            }

            function generateDiscordMessage() {
                const useTimestamps = useTimestampsToggle.checked;
                const format = timestampFormatSelect.value;
                const isTodayNormal = !scheduleControls.today.normalSchedule.classList.contains('hidden');
                const isTomorrowNormal = !scheduleControls.tomorrow.normalSchedule.classList.contains('hidden');
                const announcementTitle = discordTitleInput.value;

                const todayTimes = isTodayNormal 
                    ? useTimestamps
                        ? `- <t:${getTimestamp(today, 9, 30)}:${format}> to <t:${getTimestamp(today, 12, 30)}:${format}>\n- <t:${getTimestamp(today, 13, 0)}:${format}> to <t:${getTimestamp(today, 16, 0)}:${format}>\n- <t:${getTimestamp(today, 17, 0)}:${format}> to <t:${getTimestamp(today, 20, 0)}:${format}>\n- <t:${getTimestamp(today, 21, 0)}:${format}> to <t:${getTimestamp(tomorrow, 0, 0)}:${format}>`
                        : `- 9:30 AM to 12:30 PM\n- 1:00 PM to 4:00 PM\n- 5:00 PM to 8:00 PM\n- 9:00 PM to 12:00 AM`
                    : useTimestamps
                        ? `- <t:${getTimestamp(today, 9, 30)}:${format}> to <t:${getTimestamp(today, 12, 30)}:${format}>\n- <t:${getTimestamp(today, 12, 30)}:${format}> to <t:${getTimestamp(today, 15, 30)}:${format}>`
                        : `- 9:30 AM to 12:30 PM\n- 12:30 PM to 3:30 PM`;

                const tomorrowTimes = isTomorrowNormal
                    ? useTimestamps
                        ? `- <t:${getTimestamp(tomorrow, 9, 30)}:${format}> to <t:${getTimestamp(tomorrow, 12, 30)}:${format}>\n- <t:${getTimestamp(tomorrow, 13, 0)}:${format}> to <t:${getTimestamp(tomorrow, 16, 0)}:${format}>\n- <t:${getTimestamp(tomorrow, 17, 0)}:${format}> to <t:${getTimestamp(tomorrow, 20, 0)}:${format}>\n- <t:${getTimestamp(tomorrow, 21, 0)}:${format}> to <t:${new Date(tomorrow).setDate(tomorrow.getDate()+1) && getTimestamp(tomorrow, 0, 0)}:${format}>`
                        : `- 9:30 AM to 12:30 PM\n- 1:00 PM to 4:00 PM\n- 5:00 PM to 8:00 PM\n- 9:00 PM to 12:00 AM`
                    : useTimestamps
                        ? `- <t:${getTimestamp(tomorrow, 9, 30)}:${format}> to <t:${getTimestamp(tomorrow, 12, 30)}:${format}>\n- <t:${getTimestamp(tomorrow, 12, 30)}:${format}> to <t:${getTimestamp(tomorrow, 15, 30)}:${format}>`
                        : `- 9:30 AM to 12:30 PM\n- 12:30 PM to 3:30 PM`;
                
                const footerText = useTimestamps
                    ? `\`\`Times auto-adjust to your timezone!\`\``
                    : `\`\`All EST!\`\``;

                const message = `@Twitch Enjoyers : ${announcementTitle}\n\nI will be streaming on Twitch \`\`Today\`\` from:\n\n${todayTimes}\n\n\`\`Tomorrow\`\` I'll be streaming from:\n\n${tomorrowTimes}\n\n${footerText}\n\nhttps://www.twitch.tv/audaciousgabe`;

                discordMessageOutput.value = message;
            }

            useTimestampsToggle.addEventListener('change', generateDiscordMessage);
            timestampFormatSelect.addEventListener('change', generateDiscordMessage);
            discordTitleInput.addEventListener('input', generateDiscordMessage);

            copyMessageBtn.addEventListener('click', () => {
                discordMessageOutput.select();
                document.execCommand('copy');
                
                const originalText = copyMessageBtn.textContent;
                copyMessageBtn.textContent = 'Copied!';
                setTimeout(() => {
                    copyMessageBtn.textContent = originalText;
                }, 2000);
            });

            // --- Emoji Picker (emoji-picker-element) ---
            const emojiBtn = document.getElementById('emojiBtn');
            const emojiPicker = document.getElementById('emojiPicker');

            // Ensure dark theme for picker to match app theme
            try { emojiPicker.setAttribute('theme', 'dark'); } catch {}

            emojiPicker.addEventListener('emoji-click', (event) => {
                const { unicode } = event.detail || {};
                if (unicode) {
                    discordTitleInput.value += unicode;
                    emojiPicker.style.display = 'none';
                    generateDiscordMessage();
                }
            });

            emojiBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                emojiPicker.style.display = emojiPicker.style.display === 'block' ? 'none' : 'block';
            });

            document.addEventListener('click', (e) => {
                if (!emojiPicker.contains(e.target) && e.target !== emojiBtn) {
                    emojiPicker.style.display = 'none';
                }
            });

            // --- Export as PNG ---
            // const exportBtn = document.getElementById('exportBtn');
            // exportBtn.addEventListener('click', async () => {
            //     const elementToCapture = document.getElementById('outerPaddingContainer');
                
            //     // Store original state
            //     const originalText = exportBtn.textContent;
            //     exportBtn.textContent = 'Generating...';
            //     exportBtn.disabled = true;
                
            //     try {
            //         // Get computed styles for the current theme
            //         const computedStyles = getComputedStyle(document.body);
            //         const bgColor = computedStyles.getPropertyValue('--bg-primary').trim() || '#111827';
                    
            //         // Hide elements that shouldn't be in the export
            //         const elementsToHide = [];
            //         if (!panelScopeToggle.checked) {
            //             const bottomContent = document.getElementById('bottomContent');
            //             if (bottomContent && !bottomContent.classList.contains('hidden')) {
            //                 bottomContent.classList.add('hidden');
            //                 elementsToHide.push(bottomContent);
            //             }
            //         }
                    
            //         // Simple options without complex style processing
            //         const domToImageOptions = {
            //             quality: 1,
            //             bgcolor: bgColor,
            //             width: elementToCapture.offsetWidth,
            //             height: elementToCapture.scrollHeight,
            //             cacheBust: true,
            //             imagePlaceholder: undefined,
            //             filter: (node) => {
            //                 if (!node || !node.tagName) return true;
            //                 if (node.tagName === 'SCRIPT') return false;
            //                 return true;
            //             }
            //         };

            //         // Modern Screenshot options
            //         const modernScreenshotOptions = {
            //             backgroundColor: bgColor,
            //             scale: (window.devicePixelRatio || 2),
            //             filter: (node) => {
            //                 if (!node || !node.tagName) return true;
            //                 if (node.tagName === 'SCRIPT') return false;
            //                 return true;
            //             }
            //         };
                    
            //         // Try Modern Screenshot first, then fall back to dom-to-image-more
            //         let dataUrl;
            //         try {
            //             if (window.modernScreenshot && typeof window.modernScreenshot.domToPng === 'function') {
            //                 dataUrl = await window.modernScreenshot.domToPng(elementToCapture, modernScreenshotOptions);
            //             } else {
            //                 throw new Error('modern-screenshot not available');
            //             }
            //         } catch (msErr) {
            //             console.warn('Modern Screenshot failed, falling back to dom-to-image-more', msErr);
            //             dataUrl = await domtoimage.toPng(elementToCapture, domToImageOptions);
            //         }
                    
            //         // Restore hidden elements
            //         elementsToHide.forEach(el => el.classList.remove('hidden'));
                    
            //         // Create download link
            //         const link = document.createElement('a');
            //         const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
            //         link.download = `stream_schedule_${timestamp}.png`;
            //         link.href = dataUrl;
            //         link.click();
                    
            //         // Restore button state
            //         exportBtn.textContent = 'Downloaded!';
            //         setTimeout(() => {
            //             exportBtn.textContent = originalText;
            //             exportBtn.disabled = false;
            //         }, 2000);
                    
            //     } catch (error) {
            //         console.error('Error generating screenshot:', error);
                    
            //         // Restore any hidden elements on error
            //         const bottomContent = document.getElementById('bottomContent');
            //         if (bottomContent && bottomContent.classList.contains('hidden') && panelScopeToggle.checked) {
            //             bottomContent.classList.remove('hidden');
            //         }
                    
            //         exportBtn.textContent = 'Error - Try Again';
            //         exportBtn.disabled = false;
            //         setTimeout(() => {
            //             exportBtn.textContent = originalText;
            //         }, 3000);
            //     }
            // });

            // --- Weekly Planner ---
            const weekDayCardsContainer = document.getElementById('weekDayCards');
            const generateWeeklyBtn = document.getElementById('generateWeeklyScreenshots');
            const previewWeeklyBtn = document.getElementById('previewWeeklySchedule');
            const weeklyModal = document.getElementById('weeklyPlannerModal');
            const closeWeeklyModal = document.getElementById('closeWeeklyModal');
            const weeklyPreviewContainer = document.getElementById('weeklyPreviewContainer');
            const downloadAllWeeklyBtn = document.getElementById('downloadAllWeekly');

            const weekThemeOrder = ['twilight','sunrise','forest','oceanic','cyberpunk','pastel','arctic'];

            function getWeekDates(startDate) {
                return Array.from({ length: 7 }, (_, i) => {
                    const d = new Date(startDate);
                    d.setDate(startDate.getDate() + i);
                    d.setHours(0,0,0,0);
                    return d;
                });
            }
            
            const weekPlan = getWeekDates(today).map(d => ({ date: d, isWork: false }));
            
            function formatLong(d) {
                return d.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
            }
            function formatShort(d) {
                return d.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            }
            function ymd(d) {
                const y = d.getFullYear();
                const m = String(d.getMonth()+1).padStart(2,'0');
                const day = String(d.getDate()).padStart(2,'0');
                return `${y}-${m}-${day}`;
            }
            function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

            function buildWeekCards() {
                if (!weekDayCardsContainer) return;
                weekDayCardsContainer.innerHTML = '';
                weekPlan.forEach((item, idx) => {
                    const card = document.createElement('div');
                    card.className = 'week-day-card';
                    const label = idx === 0 ? 'Today' : idx === 1 ? 'Tomorrow' : item.date.toLocaleDateString('en-US', { weekday: 'long' });
                    card.innerHTML = `
                        <div class="flex items-center justify-between mb-3">
                            <span class="day-badge">${label}</span>
                            <span class="text-sm text-[var(--text-muted)]">${formatShort(item.date)}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-[var(--text-secondary)]">Normal</span>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="weekToggle-${idx}" class="sr-only peer" ${item.isWork ? 'checked' : ''}>
                                <div class="w-11 h-6 bg-[var(--btn-inactive-bg)] rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[var(--btn-active-bg)]"></div>
                            </label>
                            <span class="text-sm font-medium text-[var(--text-secondary)]">Work</span>
                        </div>
                    `;
                    weekDayCardsContainer.appendChild(card);
                    const toggle = card.querySelector(`#weekToggle-${idx}`);
                    toggle.addEventListener('change', () => {
                        weekPlan[idx].isWork = toggle.checked;
                    });
                });
            }
            buildWeekCards();

            function setTheme(theme) {
                const baseClasses = 'bg-[var(--bg-primary)] text-[var(--text-primary)] antialiased transition-colors duration-300';
                document.body.className = `${baseClasses} theme-${theme}`;
                // Update active state on theme buttons if visible
                try {
                    const container = document.getElementById('theme-buttons');
                    const currentActive = container.querySelector('.active');
                    if (currentActive) currentActive.classList.remove('active');
                    const newBtn = container.querySelector(`[data-theme="${theme}"]`);
                    if (newBtn) newBtn.classList.add('active');
                } catch {}
            }

            function setTodaySchedule(isWork) {
                // Use existing button handlers to keep UI in sync
                if (isWork) {
                    scheduleControls.today.workBtn.click();
                } else {
                    scheduleControls.today.normalBtn.click();
                }
            }

            function setTodayHeaderForDate(d) {
                const dayName = d.toLocaleDateString('en-US', { weekday: 'long' });
                const md = d.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                todayTitleEl.innerHTML = `${dayName}'s Stream &bull; ${md}`;
            }

            async function captureCurrentPanel(pixelRatio = 3) {
                // Hide transient UI (emoji picker) during capture
                try { document.getElementById('emojiPicker').style.display = 'none'; } catch {}
                const elementToCapture = document.getElementById('outerPaddingContainer');
                const bgVar = getComputedStyle(document.body).getPropertyValue('--bg-primary').trim();
                const backgroundColor = bgVar || '#111827';
                let dataUrl;
                // Let layout settle
                await sleep(50);
                try {
                    if (window.htmlToImage && typeof window.htmlToImage.toPng === 'function') {
                        dataUrl = await window.htmlToImage.toPng(elementToCapture, {
                            pixelRatio,
                            cacheBust: true,
                            backgroundColor,
                            filter: (node) => {
                                if (!node || !node.tagName) return true;
                                if (node.id === 'weeklyPlannerModal') return false; // exclude modal if open
                                if (node.tagName === 'SCRIPT') return false;
                                return true;
                            }
                        });
                    }
                } catch {}
                if (!dataUrl) {
                    try {
                        if (window.modernScreenshot && typeof window.modernScreenshot.domToPng === 'function') {
                            dataUrl = await window.modernScreenshot.domToPng(elementToCapture, {
                                backgroundColor,
                                scale: (window.devicePixelRatio || 2)
                            });
                        } else {
                            throw new Error('modern-screenshot not available');
                        }
                    } catch (msErr) {
                        try {
                            dataUrl = await domtoimage.toPng(elementToCapture, {
                                bgcolor: backgroundColor,
                                width: elementToCapture.offsetWidth,
                                height: elementToCapture.scrollHeight,
                                cacheBust: true,
                                imagePlaceholder: undefined,
                                filter: (node) => {
                                    if (!node || !node.tagName) return true;
                                    if (node.id === 'weeklyPlannerModal') return false;
                                    if (node.tagName === 'SCRIPT') return false;
                                    return true;
                                }
                            });
                        } catch (dtiErr) {
                            console.error('Weekly export failed', msErr, dtiErr);
                            throw dtiErr;
                        }
                    }
                }
                return dataUrl;
            }

            async function generateWeekImages(options = { pixelRatio: 3, download: true }) {
                const { pixelRatio, download } = options;
                // Preserve original state
                const originalTodayTitle = todayTitleEl.innerHTML;
                const originalTomorrowTitle = tomorrowTitleEl.innerHTML;
                const originalBodyClass = document.body.className;
                const originalPanelScopeChecked = panelScopeToggle.checked;
                const originalIsWork = !scheduleControls.today.workSchedule.classList.contains('hidden'); // work shown means true

                // Force Today Only scope
                if (panelScopeToggle.checked) {
                    panelScopeToggle.checked = false;
                    panelScopeToggle.dispatchEvent(new Event('change'));
                }

                const results = [];
                for (let i = 0; i < weekPlan.length; i++) {
                    const { date, isWork } = weekPlan[i];
                    const theme = weekThemeOrder[i % weekThemeOrder.length];

                    // Apply theme and schedule
                    setTheme(theme);
                    setTodaySchedule(isWork);
                    setTodayHeaderForDate(date);

                    // Capture
                    const dataUrl = await captureCurrentPanel(pixelRatio);
                    const dayName = date.toLocaleDateString('en-US', { weekday: 'short' });
                    const fileName = `schedule_${ymd(date)}_${dayName.toLowerCase()}_${theme}_${isWork ? 'work' : 'normal'}.png`;
                    results.push({ name: fileName, dataUrl });

                    if (download) {
                        const link = document.createElement('a');
                        link.download = fileName;
                        link.href = dataUrl;
                        link.click();
                        await sleep(150); // small delay between downloads
                    }
                    if (generateWeeklyBtn) {
                        generateWeeklyBtn.textContent = `Generating... (${i+1}/7)`;
                    }
                }

                // Restore state
                todayTitleEl.innerHTML = originalTodayTitle;
                tomorrowTitleEl.innerHTML = originalTomorrowTitle;
                document.body.className = originalBodyClass;
                setTodaySchedule(originalIsWork);
                if (panelScopeToggle.checked !== originalPanelScopeChecked) {
                    panelScopeToggle.checked = originalPanelScopeChecked;
                    panelScopeToggle.dispatchEvent(new Event('change'));
                }

                return results;
            }

            if (generateWeeklyBtn) {
                generateWeeklyBtn.addEventListener('click', async () => {
                    try {
                        generateWeeklyBtn.disabled = true;
                        generateWeeklyBtn.textContent = 'Preparing...';
                        await generateWeekImages({ pixelRatio: 3, download: true });
                        generateWeeklyBtn.textContent = 'Done!';
                        setTimeout(() => {
                            generateWeeklyBtn.textContent = '📅 Generate Week Screenshots';
                            generateWeeklyBtn.disabled = false;
                        }, 1200);
                    } catch (e) {
                        console.error(e);
                        generateWeeklyBtn.textContent = 'Error - Try Again';
                        setTimeout(() => {
                            generateWeeklyBtn.textContent = '📅 Generate Week Screenshots';
                            generateWeeklyBtn.disabled = false;
                        }, 2000);
                    }
                });
            }

            if (previewWeeklyBtn) {
                previewWeeklyBtn.addEventListener('click', async () => {
                    try {
                        previewWeeklyBtn.disabled = true;
                        previewWeeklyBtn.textContent = 'Generating Previews...';
                        const images = await generateWeekImages({ pixelRatio: 1.5, download: false });
                        weeklyPreviewContainer.innerHTML = '';
                        images.forEach((img, i) => {
                            const wrap = document.createElement('div');
                            wrap.className = 'screenshot-preview';
                            const meta = document.createElement('div');
                            meta.className = 'px-3 py-2 text-sm text-[var(--text-secondary)] flex items-center justify-between bg-[var(--bg-secondary)] border-b border-[var(--border-primary)]';
                            const [ , ymdPart, dayPart, theme, mode ] = img.name.replace('.png','').split('_');
                            meta.textContent = `${ymdPart} • ${dayPart.toUpperCase()} • ${theme} • ${mode}`;
                            const imageEl = document.createElement('img');
                            imageEl.src = img.dataUrl;
                            imageEl.alt = img.name;
                            imageEl.style.width = '100%';
                            wrap.appendChild(meta);
                            wrap.appendChild(imageEl);
                            weeklyPreviewContainer.appendChild(wrap);
                        });
                        weeklyModal.style.display = 'block';
                    } catch (e) {
                        console.error(e);
                    } finally {
                        previewWeeklyBtn.textContent = '👁️ Preview All Days';
                        previewWeeklyBtn.disabled = false;
                    }
                });
            }
            if (closeWeeklyModal) {
                closeWeeklyModal.addEventListener('click', () => { weeklyModal.style.display = 'none'; });
            }
            if (downloadAllWeeklyBtn) {
                downloadAllWeeklyBtn.addEventListener('click', async () => {
                    try {
                        downloadAllWeeklyBtn.disabled = true;
                        downloadAllWeeklyBtn.textContent = 'Zipping...';
                        const images = await generateWeekImages({ pixelRatio: 3, download: false });
                        if (!window.JSZip) throw new Error('JSZip not loaded');
                        const zip = new JSZip();
                        images.forEach(img => {
                            const base64 = img.dataUrl.split(',')[1];
                            zip.file(img.name, base64, { base64: true });
                        });
                        const blob = await zip.generateAsync({ type: 'blob' });
                        if (window.saveAs) {
                            window.saveAs(blob, `weekly_schedules_${ymd(new Date())}.zip`);
                        } else {
                            // Fallback: trigger download via object URL
                            const url = URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `weekly_schedules_${ymd(new Date())}.zip`;
                            a.click();
                            URL.revokeObjectURL(url);
                        }
                        downloadAllWeeklyBtn.textContent = 'Downloaded!';
                        setTimeout(() => { downloadAllWeeklyBtn.textContent = '💾 Download All as ZIP'; downloadAllWeeklyBtn.disabled = false; }, 1200);
                    } catch (e) {
                        console.error(e);
                        downloadAllWeeklyBtn.textContent = 'Error - Try Again';
                        setTimeout(() => { downloadAllWeeklyBtn.textContent = '💾 Download All as ZIP'; downloadAllWeeklyBtn.disabled = false; }, 2000);
                    }
                });
            }

            // Initial generation
            generateDiscordMessage();
        });
    </script>
<script src="https://cdn.jsdelivr.net/npm/html-to-image@1.11.11/dist/html-to-image.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
<script>
    document.getElementById('exportBtn').addEventListener('click', async function () {
        const exportBtn = this;
        // Ensure fonts are loaded for correct metrics
        if (document.fonts && document.fonts.ready) {
            try { await document.fonts.ready; } catch {}
        }
        const elementToCapture = document.getElementById('outerPaddingContainer');
        const bgVar = getComputedStyle(document.body).getPropertyValue('--bg-primary').trim();
        const backgroundColor = bgVar || '#111827';
        const elementsToHide = [];

        // Reflect current panel scope (hide bottomContent if Today Only)
        try {
            const panelScopeToggle = document.getElementById('panelScopeToggle');
            if (panelScopeToggle && !panelScopeToggle.checked) {
                const bottomContent = document.getElementById('bottomContent');
                if (bottomContent && !bottomContent.classList.contains('hidden')) {
                    bottomContent.classList.add('hidden');
                    elementsToHide.push(bottomContent);
                }
            }
        } catch {}

        // Disable button during export
        const originalText = exportBtn.textContent;
        exportBtn.textContent = 'Generating...';
        exportBtn.disabled = true;

        // Export-only: remove backdrop filters and flatten semi-transparent backgrounds/borders
        const modified = [];
        const parseColor = (str) => {
            if (!str) return null; const m = str.match(/rgba?\(([^)]+)\)/); if (m){ const p=m[1].split(',').map(s=>parseFloat(s)); return {r:p[0],g:p[1],b:p[2],a:p[3]??1};}
            if (/^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(str)){ let hex=str.slice(1); if(hex.length===3){hex=hex.split('').map(c=>c+c).join('');} return {r:parseInt(hex.slice(0,2),16),g:parseInt(hex.slice(2,4),16),b:parseInt(hex.slice(4,6),16),a:1}; }
            return null;
        };
        const toHex = ({r,g,b}) => `#${[r,g,b].map(n=>Math.round(n).toString(16).padStart(2,'0')).join('')}`;
        const blend = (fg, bg) => { const a=fg.a+bg.a*(1-fg.a); return { r:(fg.r*fg.a+bg.r*bg.a*(1-fg.a))/a, g:(fg.g*fg.a+bg.g*bg.a*(1-fg.a))/a, b:(fg.b*fg.a+bg.b*bg.a*(1-fg.a))/a, a}; };
        const base = parseColor(backgroundColor) || {r:17,g:24,b:39,a:1};
        const getNearestSolidBg = (el) => {
            let cur = el;
            while (cur && cur !== elementToCapture.parentElement) {
                const cs = getComputedStyle(cur);
                const bgc = parseColor(cs.backgroundColor);
                if (bgc && bgc.a > 0) return bgc;
                cur = cur.parentElement;
            }
            return base;
        };
        elementToCapture.querySelectorAll('*').forEach(el => {
            const cs = getComputedStyle(el);
            if ((cs.backdropFilter && cs.backdropFilter!=='none') || (cs.webkitBackdropFilter && cs.webkitBackdropFilter!=='none')){
                modified.push({el, prop:'backdropFilter', prev: el.style.backdropFilter});
                modified.push({el, prop:'webkitBackdropFilter', prev: el.style.webkitBackdropFilter});
                el.style.backdropFilter='none'; el.style.webkitBackdropFilter='none';
            }
            const bgc = parseColor(cs.backgroundColor);
            if (bgc && bgc.a<1){
                const under = getNearestSolidBg(el.parentElement || elementToCapture);
                const blended = blend(bgc, under);
                modified.push({el, prop:'backgroundColor', prev: el.style.backgroundColor});
                el.style.backgroundColor = toHex(blended);
            }
            // Flatten semi-transparent border colors on all sides
            const sides = ['Top','Right','Bottom','Left'];
            const anyBorder = sides.some(s => cs[`border${s}Width`] && cs[`border${s}Width`] !== '0px');
            if (anyBorder) {
                const under = getNearestSolidBg(el.parentElement || elementToCapture);
                sides.forEach(side => {
                    const col = parseColor(cs[`border${side}Color`]);
                    const w = cs[`border${side}Width`];
                    if (w && w !== '0px' && col && col.a < 1) {
                        const blended = blend(col, under);
                        const hex = toHex(blended);
                        const prop = `border${side}Color`;
                        modified.push({el, prop, prev: el.style[prop]});
                        el.style[prop] = hex;
                    }
                });
            }
            // Temporarily hide outlines if any
            if (cs.outlineStyle && cs.outlineStyle !== 'none') {
                modified.push({el, prop:'outline', prev: el.style.outline});
                el.style.outline = 'none';
            }
        });

        let dataUrl;
        try {
            // Try html-to-image first
            if (window.htmlToImage && typeof window.htmlToImage.toPng === 'function') {
                try {
                    dataUrl = await window.htmlToImage.toPng(elementToCapture, {
                        pixelRatio: 3,
                        cacheBust: true,
                        backgroundColor,
                        filter: (node) => {
                            if (!node || !node.tagName) return true;
                            if (node.tagName === 'SCRIPT') return false;
                            return true;
                        }
                    });
                } catch (e) {
                    // continue to other methods
                }
            }

            // Then try modern-screenshot
            if (!dataUrl) {
                try {
                    if (window.modernScreenshot && typeof window.modernScreenshot.domToPng === 'function') {
                        dataUrl = await window.modernScreenshot.domToPng(elementToCapture, {
                            backgroundColor,
                            scale: (window.devicePixelRatio || 2)
                        });
                    } else {
                        throw new Error('modern-screenshot not available');
                    }
                } catch (msErr) {
                    // Fallback to dom-to-image-more
                    try {
                        dataUrl = await domtoimage.toPng(elementToCapture, {
                            bgcolor: backgroundColor,
                            width: elementToCapture.offsetWidth,
                            height: elementToCapture.scrollHeight,
                            cacheBust: true,
                            imagePlaceholder: undefined,
                            filter: (node) => {
                                if (!node || !node.tagName) return true;
                                if (node.tagName === 'SCRIPT') return false;
                                return true;
                            }
                        });
                    } catch (dtiErr) {
                        console.error('Export failed', msErr, dtiErr);
                        throw dtiErr;
                    }
                }
            }

            const link = document.createElement('a');
            link.download = `stream_schedule_${new Date().toISOString().replace(/[:.]/g, '-')}.png`;
            link.href = dataUrl;
            link.click();
            exportBtn.textContent = 'Downloaded!';
            setTimeout(() => { exportBtn.textContent = originalText; exportBtn.disabled = false; }, 1500);
        } catch (err) {
            exportBtn.textContent = 'Error - Try Again';
            setTimeout(() => { exportBtn.textContent = originalText; exportBtn.disabled = false; }, 2000);
        } finally {
            // Restore styles and hidden elements
            modified.forEach(({el, prop, prev}) => { el.style[prop] = prev; });
            elementsToHide.forEach(el => el.classList.remove('hidden'));
            if (!exportBtn.disabled) exportBtn.disabled = false;
        }
    });
</script>
</body>
</html>